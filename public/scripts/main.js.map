{"version":3,"sources":["main.js"],"names":["ready","fn","document","readyState","addEventListener","attachEvent","readyWrap","button","getElementsByClassName","feedbackContainer","inputs","getElementsByTagName","inspectionForm","logoNav","security","navigator","serviceWorker","register","then","registration","console","log","scope","catch","e","inputWidthController","target","base","chars","value","length","size","sendRequest","form","feedback","createElement","className","innerHTML","appendChild","ga","hitType","eventCategory","eventAction","eventLabel","onLine","textContent","setAttribute","fetch","method","headers","body","JSON","stringify","address","querySelector","contact","name","time","response","ok","reset","removeAttribute","error","formConnectionManager","hasChildNodes","removeChild","firstChild","window","location","i","preventDefault"],"mappings":"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","sourcesContent":["/* eslint-env browser */\n/* global ga */\n\nfunction ready(fn) {\n  if (document.readyState !== \"loading\") {\n    fn();\n  } else if (document.addEventListener) {\n    document.addEventListener(\"DOMContentLoaded\", fn);\n  } else {\n    document.attachEvent(\"onreadystatechange\", () => {\n      if (document.readyState !== \"loading\") {\n        fn();\n      }\n    });\n  }\n}\n\nfunction readyWrap() {\n  const button = document.getElementsByClassName(\"form_submit\")[0];\n  const feedbackContainer = document.getElementsByClassName(\"form_feedback\");\n  const inputs = document.getElementsByTagName(\"input\");\n  const inspectionForm = document.getElementsByClassName(\"inspection_form\");\n  const logoNav = document.getElementsByClassName(\"logoNav\");\n  const security = document.getElementsByClassName(\"form_security\");\n\n  // Register the ServiceWorker.\n  if (\"serviceWorker\" in navigator) {\n    // The service worker cannot access parent directories (apart from explicity setting scope), so keep it in the root directory.\n    navigator.serviceWorker\n      .register(\"serviceWorker.js\")\n      .then((registration) => {\n        console.log(\n          `ServiceWorker registration successful with scope: ${registration.scope}`\n        );\n      })\n      .catch((e) => {\n        console.log(`ServiceWorker registration failed: ${e}`);\n      });\n  }\n\n  function inputWidthController(target) {\n    const base = 25; // base size for all inputs\n    const chars = target.value.length;\n    const size = target.size;\n    if (chars > size) {\n      // if the input needs to expand\n      target.size = target.value.length; // expand it\n      return target.size;\n    } else if (chars < size && chars > base) {\n      // if the input contains less than its width and still has more than 15 characters\n      target.size = target.value.length; // shrink it\n      return target.size;\n    } // otherwise\n    target.size = base; // set to the base width\n    return target.size;\n  }\n\n  function sendRequest() {\n    const form = inspectionForm[0];\n    const feedback = document.createElement(\"p\");\n\n    if (security[0].value) {\n      feedback.className = \"feedback_error\";\n      feedback.innerHTML =\n        \"Sorry for the inconvenience, but you somehow triggered our anti-spam protection. Please use the contact information at the <a data-scroll href='#footer'>bottom of the page</a> to reach us.\";\n      feedbackContainer[0].appendChild(feedback);\n\n      return ga(\"send\", {\n        hitType: \"event\",\n        eventCategory: \"Form\",\n        eventAction: \"spam\",\n        eventLabel: \"Contact Form\",\n      });\n    } else {\n      if (navigator.onLine === false) {\n        feedback.className = \"feedback_warning\";\n        feedback.innerHTML =\n          \"Sorry for the inconvenience, but you are currently offline. You can't send a message while offline. You can wait until you are back online or use the contact information at the <a data-scroll href='#footer'>bottom of the page</a> to reach us.\";\n        feedbackContainer[0].appendChild(feedback);\n\n        return ga(\"send\", {\n          hitType: \"event\",\n          eventCategory: \"Form\",\n          eventAction: \"offline\",\n          eventLabel: \"Contact Form\",\n        });\n      }\n\n      button.textContent = \"Sending Messageâ€¦\";\n      button.setAttribute(\"disabled\", \"true\");\n\n      return fetch(\"/api/sms-send\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          address: form.querySelector('[name=\"address\"]').value,\n          contact: form.querySelector('[name=\"contact\"]').value,\n          name: form.querySelector('[name=\"name\"]').value,\n          time: form.querySelector('[name=\"time\"]').value,\n        }),\n      })\n        .then((response) => {\n          if (!response.ok) {\n            feedback.className = \"feedback_warning\";\n            feedback.innerHTML =\n              \"Sorry for the inconvenience, but your message may have not sent. You can try sending it again or use the contact information at the <a data-scroll href='#footer'>bottom of the page</a> to reach us.\";\n            feedbackContainer[0].appendChild(feedback);\n\n            return ga(\"send\", {\n              hitType: \"event\",\n              eventCategory: \"Form\",\n              eventAction: \"fail\",\n              eventLabel: \"Contact Form\",\n            });\n          }\n\n          feedback.className = \"feedback_success\";\n          feedback.innerHTML = \"Your message was sent!\";\n          feedbackContainer[0].appendChild(feedback);\n\n          document.querySelector(\".inspection_form\").reset();\n          button.textContent = \"Send\";\n          button.removeAttribute(\"disabled\");\n\n          return ga(\"send\", {\n            hitType: \"event\",\n            eventCategory: \"Form\",\n            eventAction: \"send\",\n            eventLabel: \"Contact Form\",\n          });\n        })\n        .catch((error) => {\n          console.error(error);\n\n          return ga(\"send\", {\n            hitType: \"event\",\n            eventCategory: \"Form\",\n            eventAction: \"fail\",\n            eventLabel: \"Contact Form\",\n          });\n        });\n    }\n  }\n\n  function formConnectionManager() {\n    if (navigator.onLine === false) {\n      const feedback = document.createElement(\"p\");\n\n      button.setAttribute(\"disabled\", \"true\");\n      button.className = \"button form_submit disabled\";\n\n      feedback.className = \"feedback_warning\";\n      feedback.innerHTML =\n        \"Sorry for the inconvenience, but you are currently offline. You can't send a message while offline. You can wait until you are back online or use the contact information at the <a data-scroll href='#footer'>bottom of the page</a> to reach us.\";\n      return feedbackContainer[0].appendChild(feedback);\n    }\n    while (feedbackContainer[0].hasChildNodes()) {\n      feedbackContainer[0].removeChild(feedbackContainer[0].firstChild);\n    }\n\n    button.className = \"button form_submit\";\n    return button.removeAttribute(\"disabled\");\n  }\n\n  /* event listeners & function calls */\n  if (logoNav.length) {\n    logoNav[0].addEventListener(\"click\", () => {\n      window.location = \"https://sewercam.net/\";\n    });\n  }\n\n  if (inputs.length) {\n    // the only page with a form is 'your-sewer-scope.html'\n    for (let i = 0; i < inputs.length; i += 1) {\n      inputs[i].addEventListener(\"input\", (e) => {\n        inputWidthController(e.target);\n      });\n    }\n\n    inspectionForm[0].addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      return sendRequest();\n    });\n\n    window.addEventListener(\"online\", formConnectionManager);\n\n    window.addEventListener(\"offline\", formConnectionManager);\n  }\n}\n\nready(readyWrap);\n"],"file":"main.js"}