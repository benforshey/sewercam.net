{"version":3,"sources":["main.js"],"names":["ready","fn","document","readyState","addEventListener","attachEvent","readyWrap","button","getElementsByClassName","feedbackContainer","inputs","getElementsByTagName","inspectionForm","logoNav","security","navigator","serviceWorker","register","then","registration","console","log","scope","catch","e","inputWidthController","target","base","chars","value","length","size","sendReport","AJAX","XMLHttpRequest","feedback","createElement","payload","FormData","URL","className","innerHTML","appendChild","onLine","status","ga","hitType","eventCategory","eventAction","eventLabel","querySelector","reset","open","send","formConnectionManager","setAttribute","hasChildNodes","removeChild","firstChild","removeAttribute","window","location","i","preventDefault"],"mappings":"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","file":"main.js","sourcesContent":["/* eslint-env browser */\n/* global ga */\nfunction ready(fn) {\n  if (document.readyState !== 'loading') {\n    fn();\n  } else if (document.addEventListener) {\n    document.addEventListener('DOMContentLoaded', fn);\n  } else {\n    document.attachEvent('onreadystatechange', () => {\n      if (document.readyState !== 'loading') {\n        fn();\n      }\n    });\n  }\n}\n\nfunction readyWrap() {\n  const button = document.getElementsByClassName('form_submit')[0];\n  const feedbackContainer = document.getElementsByClassName('form_feedback');\n  const inputs = document.getElementsByTagName('input');\n  const inspectionForm = document.getElementsByClassName('inspection_form');\n  const logoNav = document.getElementsByClassName('logoNav');\n  const security = document.getElementsByClassName('form_security');\n\n  // Register the ServiceWorker.\n  if ('serviceWorker' in navigator) {\n    // The service worker cannot access parent directories (apart from explicity setting scope), so keep it in the root directory.\n    navigator.serviceWorker.register('serviceWorker.js').then((registration) => {\n      console.log(`ServiceWorker registration successful with scope: ${registration.scope}`);\n    }).catch((e) => {\n      console.log(`ServiceWorker registration failed: ${e}`);\n    });\n  }\n\n  function inputWidthController(target) {\n    const base = 25; // base size for all inputs\n    const chars = target.value.length;\n    const size = target.size;\n    if (chars > size) { // if the input needs to expand\n      target.size = target.value.length; // expand it\n      return target.size;\n    } else if (chars < size && chars > base) { // if the input contains less than its width and still has more than 15 characters\n      target.size = target.value.length; // shrink it\n      return target.size;\n    } // otherwise\n    target.size = base; // set to the base width\n    return target.size;\n  }\n\n  function sendReport() {\n    const AJAX = new XMLHttpRequest();\n    const feedback = document.createElement('p');\n    const payload = new FormData(inspectionForm[0]);\n    const URL = 'https://message.integrisweb.com/sms/';\n\n    if (security[0].value) { // if the security input has a value, it's been filled\n      feedback.className = 'feedback_error';\n      feedback.innerHTML = \"Sorry for the inconvenience, but you somehow triggered our anti-spam protection. Please use the contact information at the <a data-scroll href='#footer'>bottom of the page</a> to reach us.\";\n      feedbackContainer[0].appendChild(feedback);\n    } else {\n      if (navigator.onLine === false) {\n        feedback.className = 'feedback_warning';\n        feedback.innerHTML = \"Sorry for the inconvenience, but you are currently offline. You can't send a message while offline. You can wait until you are back online or use the contact information at the <a data-scroll href='#footer'>bottom of the page</a> to reach us.\";\n        feedbackContainer[0].appendChild(feedback);\n      }\n\n      AJAX.addEventListener('load', (e) => {\n        if (e.target.status === 200) { // if the message was sent\n          feedback.className = 'feedback_success';\n          feedback.innerHTML = 'Your message was sent!';\n          feedbackContainer[0].appendChild(feedback);\n\n          ga('send', { // since GA is loaded in the head, assume its presence\n            hitType: 'event',\n            eventCategory: 'Form',\n            eventAction: 'send',\n            eventLabel: 'Contact Form',\n          });\n\n          document.querySelector('.inspection_form').reset(); // empty the form on success\n        } else { // something nonspecific has gone wrong\n          feedback.className = 'feedback_warning';\n          feedback.innerHTML = \"Sorry for the inconvenience, but your message may have not sent. You can try sending it again or use the contact information at the <a data-scroll href='#footer'>bottom of the page</a> to reach us.\";\n          feedbackContainer[0].appendChild(feedback);\n        }\n      });\n\n      AJAX.open('POST', URL, true);\n      AJAX.send(payload);\n    }\n  }\n\n  function formConnectionManager() {\n    if (navigator.onLine === false) {\n      const feedback = document.createElement('p');\n\n      button.setAttribute('disabled', 'true');\n      button.className = 'button form_submit disabled';\n\n      feedback.className = 'feedback_warning';\n      feedback.innerHTML = \"Sorry for the inconvenience, but you are currently offline. You can't send a message while offline. You can wait until you are back online or use the contact information at the <a data-scroll href='#footer'>bottom of the page</a> to reach us.\";\n      return feedbackContainer[0].appendChild(feedback);\n    }\n    while (feedbackContainer[0].hasChildNodes()) {\n      feedbackContainer[0].removeChild(feedbackContainer[0].firstChild);\n    }\n\n    button.removeAttribute('disabled');\n    button.className = 'button form_submit';\n    return button.className;\n  }\n\n  /* event listeners & function calls */\n\n  if (logoNav.length) {\n    logoNav[0].addEventListener('click', () => {\n      window.location = 'https://sewercam.net/';\n    });\n  }\n\n  if (inputs.length) { // the only page with a form is 'your-sewer-scope.html'\n    for (let i = 0; i < inputs.length; i += 1) {\n      inputs[i].addEventListener('input', (e) => {\n        inputWidthController(e.target);\n      });\n    }\n\n    inspectionForm[0].addEventListener('submit', (e) => {\n      e.preventDefault();\n      return sendReport();\n    });\n\n    window.addEventListener('online', formConnectionManager);\n\n    window.addEventListener('offline', formConnectionManager);\n  }\n}\n\nready(readyWrap);\n"]}